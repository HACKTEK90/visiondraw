<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vision Drawing + Images</title>
  <script src="https://js.puter.com/v2/"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    :root {
      --accent: #111;
      --bg: #f9f9f9;
      --text: #111;
    }
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      margin: 0;
      padding: 24px;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    #canvas {
      border: 1px solid var(--accent);
      background: #fff;
      width: min(90vw, 650px);
      height: 60vh;
      max-height: 520px;
      touch-action: none;
      border-radius: 0;
    }
    #toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      width: 100%;
      max-width: 650px;
    }
    input[type="text"],
    input[type="file"],
    input[type="color"],
    button,
    input[type="range"] {
      padding: 10px 12px;
      font-size: 14px;
      border: 1px solid var(--accent);
      border-radius: 0;
      background: #fff;
      transition: 0.2s;
    }
    button {
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover {
      background: #222;
    }
    #status, #answer {
      max-width: 650px;
      width: 100%;
      border: 1px solid var(--accent);
      border-radius: 0;
      padding: 12px;
      background: #f0f0f0;
      text-align: left;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <div id="toolbar">
    <input type="color" id="color" title="Brush colour" value="#000000">
    <input type="range" id="size" min="1" max="20" value="4" title="Brush size">
    <input type="file" id="imgInput" accept="image/*" title="Import image">
    <input type="text" id="q" placeholder="Ask something about the canvas‚Ä¶" style="flex:1;min-width:160px">
    <button id="askBtn">Ask AI</button>
    <button id="clearBtn">Clear</button>
  </div>
  <div id="status">üñºÔ∏è Images: 0  |  ‚úèÔ∏è Strokes: 0</div>
  <div id="answer">üß† Ready.</div>
<script>
let strokes=[],images=[];
const canvasEl=document.getElementById('canvas');
const ctx=canvasEl.getContext('2d');
resizeCanvas();
window.addEventListener('resize',resizeCanvas);
function resizeCanvas(){
  const rect=canvasEl.getBoundingClientRect();
  canvasEl.width =rect.width;
  canvasEl.height=rect.height;
  ctx.lineCap='round';
  ctx.lineWidth=parseInt(document.getElementById('size').value);
  ctx.strokeStyle=document.getElementById('color').value;
  redraw();
}
function updateStatus(extra=''){
  const status=document.getElementById('status');
  status.textContent=`üñºÔ∏è Images: ${images.length}  |  ‚úèÔ∏è Strokes: ${strokes.length}`+(extra?`  |  ${extra}`:'');
}
let drawing=false;
canvasEl.addEventListener('pointerdown',e=>{
  drawing=true;
  const s=[{x:e.offsetX,y:e.offsetY,col:ctx.strokeStyle,sz:ctx.lineWidth}];
  strokes.push(s);
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
  updateStatus('Drawing‚Ä¶');
});
canvasEl.addEventListener('pointermove',e=>{
  if(!drawing) return;
  const s=strokes[strokes.length-1];
  s.push({x:e.offsetX,y:e.offsetY});
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
});
['pointerup','pointerleave','pointercancel'].forEach(ev=>
  canvasEl.addEventListener(ev,()=>{if(drawing){drawing=false;updateStatus();}}));
const colour=document.getElementById('color');
colour.oninput=e=>{ctx.strokeStyle=e.target.value};
const sizeSlider=document.getElementById('size');
sizeSlider.oninput=e=>{ctx.lineWidth=parseInt(e.target.value)};
const clearBtn = document.getElementById('clearBtn');
clearBtn.onclick=()=>{
  strokes.length=0;
  images.length=0;
  redraw();
  updateStatus();
  answer('üßπ Canvas cleared.');
};
const imgInput = document.getElementById('imgInput');
imgInput.onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  const img=new Image();
  img.onload=()=>{
    const maxW=canvasEl.width*0.6,maxH=canvasEl.height*0.6;
    let w=img.width,h=img.height;
    const ratio=Math.min(maxW/w, maxH/h,1);
    w*=ratio; h*=ratio;
    const x=(canvasEl.width -w)/2;
    const y=(canvasEl.height-h)/2;
    images.push({img,x,y,w,h});
    redraw();
    updateStatus('Image added');
  };
  img.src=URL.createObjectURL(file);
  e.target.value='';
};
function redraw(){
  ctx.clearRect(0,0,canvasEl.width,canvasEl.height);
  images.forEach(o=>ctx.drawImage(o.img,o.x,o.y,o.w,o.h));
  strokes.forEach(path=>{
    ctx.strokeStyle=path[0].col||ctx.strokeStyle;
    ctx.lineWidth =path[0].sz ||ctx.lineWidth;
    ctx.beginPath();
    ctx.moveTo(path[0].x,path[0].y);
    for(let i=1;i<path.length;i++) ctx.lineTo(path[i].x,path[i].y);
    ctx.stroke();
  });
}
function answer(msg){document.getElementById('answer').textContent=msg;}
updateStatus();
const askBtn = document.getElementById('askBtn');
askBtn.onclick=async()=>{
  const q=document.getElementById('q').value.trim();
  if(!q){answer('‚ùó Enter a question.');return;}
  answer('‚è≥ Processing‚Ä¶');
  const imgData=canvasEl.toDataURL('image/png');
  try{
    const reply=await puter.ai.chat(q,imgData);
    answer(reply||'(no reply)');
  }catch(err){console.error(err);answer('‚ùå '+err.message);} };
</script>
</body>
</html>
